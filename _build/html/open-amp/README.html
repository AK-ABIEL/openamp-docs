<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>open-amp &mdash; OpenAMP  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/mystyle.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> OpenAMP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../openamp/index.html">OpenAMP Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocol_details/index.html">OpenAMP Protocol Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/index.html">OpenAMP API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenAMP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>open-amp</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/open-amp/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="open-amp">
<h1>open-amp<a class="headerlink" href="#open-amp" title="Permalink to this heading"></a></h1>
<p>This repository is the home for the Open Asymmetric Multi Processing (OpenAMP)
framework project. The OpenAMP framework provides software components that
enable development of software applications for Asymmetric Multiprocessing
(AMP) systems. The framework provides the following key capabilities.</p>
<ol class="arabic simple">
<li><p>Provides Life Cycle Management, and Inter Processor Communication
capabilities for management of remote compute resources and their associated
software contexts.</p></li>
<li><p>Provides a stand alone library usable with RTOS and Baremetal software
environments</p></li>
<li><p>Compatibility with upstream Linux remoteproc and rpmsg components</p></li>
<li><p>Following AMP configurations supported
a. Linux host/Generic(Baremetal) remote
b. Generic(Baremetal) host/Linux remote</p></li>
<li><p>Proxy infrastructure and supplied demos showcase ability of proxy on host
to handle printf, scanf, open, close, read, write calls from Bare metal
based remote contexts.</p></li>
</ol>
<section id="openamp-source-structure">
<h2>OpenAMP Source Structure<a class="headerlink" href="#openamp-source-structure" title="Permalink to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|-</span> <span class="n">lib</span><span class="o">/</span>
<span class="o">|</span>  <span class="o">|-</span> <span class="n">virtio</span><span class="o">/</span>     <span class="c1"># virtio implementation</span>
<span class="o">|</span>  <span class="o">|-</span> <span class="n">rpmsg</span><span class="o">/</span>      <span class="c1"># rpmsg implementation</span>
<span class="o">|</span>  <span class="o">|-</span> <span class="n">remoteproc</span><span class="o">/</span> <span class="c1"># remoteproc implementation</span>
<span class="o">|</span>  <span class="o">|-</span> <span class="n">proxy</span><span class="o">/</span>      <span class="c1"># implement one processor access device on the</span>
<span class="o">|</span>  <span class="o">|</span>              <span class="c1"># other processor with file operations</span>
<span class="o">|-</span> <span class="n">apps</span><span class="o">/</span>        <span class="c1"># demonstration/testing applications</span>
<span class="o">|</span>  <span class="o">|-</span> <span class="n">examples</span><span class="o">/</span> <span class="c1"># Application samples using the OpenAMP framework.</span>
<span class="o">|</span>  <span class="o">|-</span> <span class="n">machine</span><span class="o">/</span>  <span class="c1"># common files for machine can be shared by applications</span>
<span class="o">|</span>  <span class="o">|</span>            <span class="c1"># It is up to each app to decide whether to use these files.</span>
<span class="o">|</span>  <span class="o">|-</span> <span class="n">system</span><span class="o">/</span>   <span class="c1"># common files for system can be shared by applications</span>
<span class="o">|</span>               <span class="c1"># It is up to each app to decide whether to use these files.</span>
<span class="o">|-</span> <span class="n">cmake</span>        <span class="c1"># CMake files</span>
<span class="o">|-</span> <span class="n">script</span>       <span class="c1"># helper scripts (such as checkpatch) for contributors.</span>
</pre></div>
</div>
<p>OpenAMP library libopen_amp is composed of the following directories in <code class="docutils literal notranslate"><span class="pre">lib/</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">virtio/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rpmsg/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remoteproc/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proxy/</span></code></p></li>
</ul>
<p>OpenAMP system/machine support has been moved to libmetal, the system/machine
layer in the <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory is for system application initialization, and
resource table definition.</p>
<section id="libmetal-apis-used-in-openamp">
<h3>libmetal APIs used in OpenAMP<a class="headerlink" href="#libmetal-apis-used-in-openamp" title="Permalink to this heading"></a></h3>
<p>Here are the libmetal APIs used by OpenAMP, if you want to port OpenAMP for your
system, you will need to implement the following libmetal APIs in the libmetal’s
<code class="docutils literal notranslate"><span class="pre">lib/system/&lt;SYS&gt;</span></code> directory:</p>
<ul class="simple">
<li><p>alloc, for memory allocation and memory free</p></li>
<li><p>cache, for flushing cache and invalidating cache</p></li>
<li><p>io, for memory mapping. OpenAMP required memory mapping in order to access
vrings and carved out memory.</p></li>
<li><p>irq, for IRQ handler registration, IRQ disable/enable and global IRQ handling.</p></li>
<li><p>mutex</p></li>
<li><p>shmem (For RTOS, you can usually use the implementation from
<code class="docutils literal notranslate"><span class="pre">lib/system/generic/</span></code>)</p></li>
<li><p>sleep, at the moment, OpenAMP only requires microseconds sleep as when OpenAMP
fails to get a buffer to send messages, it will call this function to sleep and
then try again.</p></li>
<li><p>time, for timestamp</p></li>
<li><p>init, for libmetal initialization.</p></li>
<li><p>atomic</p></li>
</ul>
<p>Please refer to <code class="docutils literal notranslate"><span class="pre">lib/system/generic</span></code> when you port libmetal for your system.</p>
<p>If you a different compiler to GNU gcc, please refer to <code class="docutils literal notranslate"><span class="pre">lib/compiler/gcc/</span></code> to
port libmetal for your compiler. At the moment, OpenAMP needs the atomic
operations defined in <code class="docutils literal notranslate"><span class="pre">lib/compiler/gcc/atomic.h</span></code>.</p>
</section>
</section>
<section id="openamp-compilation">
<h2>OpenAMP Compilation<a class="headerlink" href="#openamp-compilation" title="Permalink to this heading"></a></h2>
<p>OpenAMP uses CMake for library and demonstration application compilation.
OpenAMP requires libmetal library. For now, you will need to download and
compile libmetal library separately before you compiling OpenAMP library.
In future, we will try to make libmetal as a submodule to OpenAMP to make this
flow easier.</p>
<p>Some Cmake options are available to allow user to customize to the OpenAMP
library for it project:</p>
<ul class="simple">
<li><p><strong>WITH_PROXY</strong> (default OFF): Include proxy support in the library.</p></li>
<li><p><strong>WITH APPS</strong> (default OFF): Build with sample applications.</p></li>
<li><p><strong>WITH_PROXY_APPS</strong> (default OFF):Build with proxy sample applications.</p></li>
<li><p><strong>WITH_VIRTIO_DRIVER</strong> (default ON): Build with virtio driver enabled.
This option can be set to OFF if the only the remote mode is implemented.</p></li>
<li><p><strong>WITH_VIRTIO_DEVICE</strong> (default ON): Build with virtio device enabled.
This option can be set to OFF if the only the driver mode is implemented.</p></li>
<li><p><strong>WITH_STATIC_LIB</strong> (default ON): Build with a static library.</p></li>
<li><p><strong>WITH_SHARED_LIB</strong> (default ON): Build with a shared library.</p></li>
<li><p><strong>WITH_ZEPHYR</strong> (default OFF): Build open-amp as a zephyr library. This option
is mandatory in a Zephyr environment.</p></li>
<li><p><strong>WITH_DCACHE_VRINGS</strong> (default OFF): Build with data cache operations
enabled on vrings.</p></li>
<li><p><strong>WITH_DCACHE_BUFFERS</strong> (default OFF): Build with data cache operations
enabled on buffers.</p></li>
<li><p><strong>RPMSG_BUFFER_SIZE</strong> (default 512): adjust the size of the RPMsg buffers.
The default value of the RPMsg size is compatible with the Linux Kernel hard
coded value. If you AMP configuration is Linux kernel host/ OpenAMP remote,
this option must not be used.</p></li>
</ul>
<section id="example-to-compile-openamp-for-zephyr">
<h3>Example to compile OpenAMP for Zephyr<a class="headerlink" href="#example-to-compile-openamp-for-zephyr" title="Permalink to this heading"></a></h3>
<p>The <a class="reference external" href="https://github.com/zephyrproject-rtos/open-amp">Zephyr open-amp repo</a>
implements the open-amp library for the Zephyr project. It is mainly a fork of
this repository, with some add-ons for integration in the Zephyr project.
The standard way to compile OpenAMP for a Zephyr project is to use Zephyr build
environment. Please refer to <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/tree/main/samples/subsys/ipc">Zephyr OpenAMP samples</a> for examples.</p>
<p>Nevertheless you can compile the OpenAMP project for Zephyr.
As OpenAMP uses libmetal, please refer to libmetal README to build libmetal
for Zephyr before building OpenAMP library for Zephyr.
As Zephyr uses CMake, we build OpenAMP library as a target of Zephyr CMake
project. Here is how to build libmetal for Zephyr:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    $ export ZEPHRY_GCC_VARIANT=zephyr
    $ export ZEPHRY_SDK_INSTALL_DIR=&lt;where Zephyr SDK is installed&gt;
    $ source &lt;git_clone_zephyr_project_source_root&gt;/zephyr-env.sh

    $ cmake &lt;OpenAMP_source_root&gt; \
      -DWITH_ZEPHYR=on -DBOARD=qemu_cortex_m3 \
      -DCMAKE_INCLUDE_PATH=&quot;&lt;libmetal_zephyr_build_dir&gt;/lib/include&quot; \
      -DCMAKE_LIBRARY_PATH=&quot;&lt;libmetal_zephyr_build_dir&gt;/lib&quot; \
    $ make VERBOSE=1 all
</pre></div>
</div>
</section>
<section id="example-to-compile-openamp-for-communication-between-linux-processes">
<h3>Example to compile OpenAMP for communication between Linux processes:<a class="headerlink" href="#example-to-compile-openamp-for-communication-between-linux-processes" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Install libsysfs devel and libhugetlbfs devel packages on your Linux host.</p></li>
<li><p>build libmetal library on your host as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    $ mkdir -p build-libmetal
    $ cd build-libmetal
    $ cmake &lt;libmetal_source&gt;
    $ make VERBOSE=1 DESTDIR=&lt;libmetal_install&gt; install
</pre></div>
</div>
</li>
<li><p>build OpenAMP library on your host as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  $ mkdir -p build-openamp
  $ cd build-openamp
  $ cmake &lt;openamp_source&gt; -DCMAKE_INCLUDE_PATH=&lt;libmetal_built_include_dir&gt; \
        -DCMAKE_LIBRARY_PATH=&lt;libmetal_built_lib_dir&gt; [-DWITH_APPS=ON]
  $ make VERBOSE=1 DESTDIR=$(pwd) install
</pre></div>
</div>
</li>
</ul>
<p>The OpenAMP library will be generated to <code class="docutils literal notranslate"><span class="pre">build/usr/local/lib</span></code> directory,
headers will be generated to <code class="docutils literal notranslate"><span class="pre">build/usr/local/include</span></code> directory, and the
applications executable will be generated to <code class="docutils literal notranslate"><span class="pre">build/usr/local/bin</span></code>
directory.</p>
<ul>
<li><p>cmake option <code class="docutils literal notranslate"><span class="pre">-DWITH_APPS=ON</span></code> is to build the demonstration applications.</p></li>
<li><p>If you have used <code class="docutils literal notranslate"><span class="pre">-DWITH_APPS=ON</span></code> to build the demos, you can try them on
your Linux host as follows:</p>
<ul>
<li><p>rpmsg echo demo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Start echo test server to wait for message to echo
$ sudo LD_LIBRARY_PATH=&lt;openamp_built&gt;/usr/local/lib:&lt;libmetal_built&gt;/usr/local/lib \
   build/usr/local/bin/rpmsg-echo-shared
# Run echo test to send message to echo test server
$ sudo LD_LIBRARY_PATH=&lt;openamp_built&gt;/usr/local/lib:&lt;libmetal_built&gt;/usr/local/lib \
   build/usr/local/bin/rpmsg-echo-ping-shared 1
</pre></div>
</div>
</li>
<li><p>rpmsg echo demo with the nocopy API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Start echo test server to wait for message to echo
$ sudo LD_LIBRARY_PATH=&lt;openamp_built&gt;/usr/local/lib:&lt;libmetal_built&gt;/usr/local/lib \
   build/usr/local/bin/rpmsg-nocopy-echo-shared
# Run echo test to send message to echo test server
$ sudo LD_LIBRARY_PATH=&lt;openamp_built&gt;/usr/local/lib:&lt;libmetal_built&gt;/usr/local/lib \
   build/usr/local/bin/rpmsg-nocopy-ping-shared 1
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="example-to-compile-zynq-ultrascale-mpsoc-r5-generic-baremetal-remote">
<h3>Example to compile Zynq UltraScale+ MPSoC R5 generic(baremetal) remote:<a class="headerlink" href="#example-to-compile-zynq-ultrascale-mpsoc-r5-generic-baremetal-remote" title="Permalink to this heading"></a></h3>
<ul>
<li><p>build libmetal library on your host as follows:</p>
<ul>
<li><p>Create your on cmake toolchain file to compile libmetal for your generic
(baremetal) platform. Here is the example of the toolchain file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="nb">set</span> <span class="p">(</span><span class="n">CMAKE_SYSTEM_PROCESSOR</span> <span class="s2">&quot;arm&quot;</span>              <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">set</span> <span class="p">(</span><span class="n">MACHINE</span> <span class="s2">&quot;zynqmp_r5&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nb">set</span> <span class="p">(</span><span class="n">CROSS_PREFIX</span>           <span class="s2">&quot;armr5-none-eabi-&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">set</span> <span class="p">(</span><span class="n">CMAKE_C_FLAGS</span>          <span class="s2">&quot;-mfloat-abi=soft -mcpu=cortex-r5 -Wall -Werror -Wextra </span><span class="se">\</span>
<span class="s2">       -flto -Os -I/ws/xsdk/r5_0_bsp/psu_cortexr5_0/include&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">SET</span><span class="p">(</span><span class="n">CMAKE_EXE_LINKER_FLAGS</span> <span class="s2">&quot;$</span><span class="si">{CMAKE_EXE_LINKER_FLAGS}</span><span class="s2"> -flto&quot;</span><span class="p">)</span>
    <span class="n">SET</span><span class="p">(</span><span class="n">CMAKE_AR</span>  <span class="s2">&quot;gcc-ar&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">SET</span><span class="p">(</span><span class="n">CMAKE_C_ARCHIVE_CREATE</span> <span class="s2">&quot;&lt;CMAKE_AR&gt; qcs &lt;TARGET&gt; &lt;LINK_FLAGS&gt; &lt;OBJECTS&gt;&quot;</span><span class="p">)</span>
    <span class="n">SET</span><span class="p">(</span><span class="n">CMAKE_C_ARCHIVE_FINISH</span>   <span class="n">true</span><span class="p">)</span>

    <span class="n">include</span> <span class="p">(</span><span class="n">cross</span><span class="o">-</span><span class="n">generic</span><span class="o">-</span><span class="n">gcc</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Compile libmetal library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    $ mkdir -p build-libmetal
    $ cd build-libmetal
    $ cmake &lt;libmetal_source&gt; -DCMAKE_TOOLCHAIN_FILE=&lt;toolchain_file&gt;
    $ make VERBOSE=1 DESTDIR=&lt;libmetal_install&gt; install
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>build OpenAMP library on your host as follows:</p>
<ul>
<li><p>Create your on cmake toolchain file to compile openamp for your generic
(baremetal) platform. Here is the example of the toolchain file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="nb">set</span> <span class="p">(</span><span class="n">CMAKE_SYSTEM_PROCESSOR</span> <span class="s2">&quot;arm&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">set</span> <span class="p">(</span><span class="n">MACHINE</span>                <span class="s2">&quot;zynqmp_r5&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">set</span> <span class="p">(</span><span class="n">CROSS_PREFIX</span>           <span class="s2">&quot;armr5-none-eabi-&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">set</span> <span class="p">(</span><span class="n">CMAKE_C_FLAGS</span>          <span class="s2">&quot;-mfloat-abi=soft -mcpu=cortex-r5 -Os -flto </span><span class="se">\</span>
<span class="s2">      -I/ws/libmetal-r5-generic/usr/local/include </span><span class="se">\</span>
<span class="s2">      -I/ws/xsdk/r5_0_bsp/psu_cortexr5_0/include&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">set</span> <span class="p">(</span><span class="n">CMAKE_ASM_FLAGS</span>        <span class="s2">&quot;-mfloat-abi=soft -mcpu=cortex-r5&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">set</span> <span class="p">(</span><span class="n">PLATFORM_LIB_DEPS</span>      <span class="s2">&quot;-lxil -lc -lm&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">SET</span><span class="p">(</span><span class="n">CMAKE_EXE_LINKER_FLAGS</span> <span class="s2">&quot;$</span><span class="si">{CMAKE_EXE_LINKER_FLAGS}</span><span class="s2"> -flto&quot;</span><span class="p">)</span>
    <span class="n">SET</span><span class="p">(</span><span class="n">CMAKE_AR</span>  <span class="s2">&quot;gcc-ar&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">SET</span><span class="p">(</span><span class="n">CMAKE_C_ARCHIVE_CREATE</span> <span class="s2">&quot;&lt;CMAKE_AR&gt; qcs &lt;TARGET&gt; &lt;LINK_FLAGS&gt; &lt;OBJECTS&gt;&quot;</span><span class="p">)</span>
    <span class="n">SET</span><span class="p">(</span><span class="n">CMAKE_C_ARCHIVE_FINISH</span>   <span class="n">true</span><span class="p">)</span>
    <span class="nb">set</span> <span class="p">(</span><span class="n">CMAKE_FIND_ROOT_PATH</span> <span class="o">/</span><span class="n">ws</span><span class="o">/</span><span class="n">libmetal</span><span class="o">-</span><span class="n">r5</span><span class="o">-</span><span class="n">generic</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span> \
        <span class="o">/</span><span class="n">ws</span><span class="o">/</span><span class="n">xsdk</span><span class="o">/</span><span class="n">r5_bsp</span><span class="o">/</span><span class="n">psu_cortexr5_0</span><span class="o">/</span><span class="n">lib</span> <span class="p">)</span>

    <span class="n">include</span> <span class="p">(</span><span class="n">cross_generic_gcc</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>We use cmake <code class="docutils literal notranslate"><span class="pre">find_path</span></code> and <code class="docutils literal notranslate"><span class="pre">find_library</span></code> to check if libmetal includes
and libmetal library is in the includes and library search paths. However,
for non-linux system, it doesn’t work with <code class="docutils literal notranslate"><span class="pre">CMAKE_INCLUDE_PATH</span></code> and
<code class="docutils literal notranslate"><span class="pre">CMAKE_LIBRARY_PATH</span></code> variables, and thus, we need to specify those paths
in the toolchain file with <code class="docutils literal notranslate"><span class="pre">CMAKE_C_FLAGS</span></code> and <code class="docutils literal notranslate"><span class="pre">CMAKE_FIND_ROOT_PATH</span></code>.</p></li>
</ul>
</li>
<li><p>Compile the OpenAMP library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p build-openamp
$ cd build-openamp
$ cmake &lt;openamp_source&gt; -DCMAKE_TOOLCHAIN_FILE=&lt;toolchain_file&gt;
$ make VERBOSE=1 DESTDIR=$(pwd) install
</pre></div>
</div>
</li>
</ul>
<p>The OpenAMP library will be generated to <code class="docutils literal notranslate"><span class="pre">build/usr/local/lib</span></code> directory,
headers will be generated to <code class="docutils literal notranslate"><span class="pre">build/usr/local/include</span></code> directory, and the
applications executable will be generated to <code class="docutils literal notranslate"><span class="pre">build/usr/local/bin</span></code>
directory.</p>
</section>
<section id="example-to-compile-openamp-linux-userspace-for-zynq-ultrascale-mpsoc">
<h3>Example to compile OpenAMP Linux Userspace for Zynq UltraScale+ MPSoC<a class="headerlink" href="#example-to-compile-openamp-linux-userspace-for-zynq-ultrascale-mpsoc" title="Permalink to this heading"></a></h3>
<p>We can use yocto to build the OpenAMP Linux userspace library and application.
open-amp and libmetal recipes are in this yocto layer:
https://github.com/OpenAMP/meta-openamp</p>
<ul class="simple">
<li><p>Add the <code class="docutils literal notranslate"><span class="pre">meta-openamp</span></code> layer to your layers in your yocto build project’s <code class="docutils literal notranslate"><span class="pre">bblayers.conf</span></code> file.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">libmetal</span></code> and <code class="docutils literal notranslate"><span class="pre">open-amp</span></code> to your packages list. E.g. add <code class="docutils literal notranslate"><span class="pre">libmetal</span></code> and <code class="docutils literal notranslate"><span class="pre">open-amp</span></code> to the
<code class="docutils literal notranslate"><span class="pre">IMAGE_INSTALL_append</span></code> in the <code class="docutils literal notranslate"><span class="pre">local.conf</span></code> file.</p></li>
<li><p>You can also add OpenAMP demos Linux applications packages to your yocto packages list. OpenAMP
demo examples recipes are also in <code class="docutils literal notranslate"><span class="pre">meta-openamp</span></code>:
https://github.com/OpenAMP/meta-openamp/tree/master/recipes-openamp/rpmsg-examples</p></li>
</ul>
<p>In order to user OpenAMP(RPMsg) in Linux userspace, you will need to have put the IPI device,
vring memory and shared buffer memory to your Linux kernel device tree. The device tree example
can be found here:
https://github.com/OpenAMP/open-amp/blob/main/apps/machine/zynqmp/openamp-linux-userspace.dtsi</p>
</section>
</section>
<section id="version">
<h2>Version<a class="headerlink" href="#version" title="Permalink to this heading"></a></h2>
<p>The OpenAMP version follows the set of rule proposed in <a class="reference external" href="https://semver.org/">Semantic Versioning specification</a>.</p>
</section>
<section id="supported-system-and-machines">
<h2>Supported System and Machines<a class="headerlink" href="#supported-system-and-machines" title="Permalink to this heading"></a></h2>
<p>For now, it supports:</p>
<ul class="simple">
<li><p>Zynq generic remote</p></li>
<li><p>Zynq UltraScale+ MPSoC R5 generic remote</p></li>
<li><p>Linux host OpenAMP between Linux userspace processes</p></li>
<li><p>Linux userspace OpenAMP RPMsg host</p></li>
<li><p>Linux userspace OpenAMP RPMsg remote</p></li>
<li><p>Linux userspace OpenAMP RPMsg and MicroBlaze bare metal remote</p></li>
</ul>
</section>
<section id="known-limitations">
<h2>Known Limitations:<a class="headerlink" href="#known-limitations" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>In case of OpenAMP on Linux userspace for inter processors communication,
it only supports static vrings and shared buffers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span></code> is required to run the OpenAMP demos between Linux processes, as
it doesn’t work on some systems if you are normal users.</p></li>
</ol>
</section>
<section id="how-to-contribute">
<h2>How to contribute:<a class="headerlink" href="#how-to-contribute" title="Permalink to this heading"></a></h2>
<p>As an open-source project, we welcome and encourage the community to submit patches directly to the project. As a contributor you  should be familiar with common developer tools such as Git and CMake, and platforms such as GitHub.
Then following points should be rescpected to facilitate the review process.</p>
<section id="licencing">
<h3>Licencing<a class="headerlink" href="#licencing" title="Permalink to this heading"></a></h3>
<p>Code is contributed to the Linux kernel under a number of licenses, but all code must be compatible with version the <a class="reference external" href="https://github.com/OpenAMP/open-amp/blob/main/LICENSE.md">BSD License</a>, which is the license covering the OpenAMP distribution as a whole. In practice, use the following tag instead of the full license text in the individual files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>```
SPDX-License-Identifier:    BSD-3-Clause
SPDX-License-Identifier:    BSD-2-Clause
```
</pre></div>
</div>
</section>
<section id="signed-off-by">
<h3>Signed-off-by<a class="headerlink" href="#signed-off-by" title="Permalink to this heading"></a></h3>
<p>Commit message must contain Signed-off-by: line and your email must match the change authorship information. Make sure your .gitconfig is set up correctly:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>```
git config --global user.name &quot;first-name Last-Namer&quot;
git config --global user.email &quot;yourmail@company.com&quot;
```
</pre></div>
</div>
</section>
<section id="gitlint">
<h3>gitlint<a class="headerlink" href="#gitlint" title="Permalink to this heading"></a></h3>
<p>Before you submit a pull request to the project, verify your commit messages meet the requirements. The check can be  performed locally using the the gitlint command.</p>
<p>Run gitlint locally in your tree and branch where your patches have been committed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  ```gitlint```
</pre></div>
</div>
<p>Note, gitlint only checks HEAD (the most recent commit), so you should run it after each commit, or use the –commits option to specify a commit range covering all the development patches to be submitted.</p>
</section>
<section id="code-style">
<h3>Code style<a class="headerlink" href="#code-style" title="Permalink to this heading"></a></h3>
<p>In general, follow the Linux kernel coding style, with the following exceptions:</p>
<ul class="simple">
<li><p>Use /**  */ for doxygen comments that need to appear in the documentation.</p></li>
</ul>
<p>The Linux kernel GPL-licensed tool checkpatch is used to check coding style conformity.Checkpatch is available in the scripts directory.</p>
<p>To check your &lt;n&gt; commits in your git branch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">checkpatch</span><span class="o">.</span><span class="n">pl</span> <span class="o">--</span><span class="n">strict</span>  <span class="o">-</span><span class="n">g</span> <span class="n">HEAD</span><span class="o">-&lt;</span><span class="n">n</span><span class="o">&gt;</span>

</pre></div>
</div>
</section>
<section id="send-a-pull-request">
<h3>Send a pull request<a class="headerlink" href="#send-a-pull-request" title="Permalink to this heading"></a></h3>
<p>We use standard github mechanism for pull request. Please refer to github documentation for help.</p>
</section>
</section>
<section id="communication-and-collaboration">
<h2>Communication and Collaboration<a class="headerlink" href="#communication-and-collaboration" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="https://lists.openampproject.org/mailman/listinfo/openamp-rp">Subscribe</a> to the OpenAMP mailing list(openamp-rp&#64;lists.openampproject.org).</p>
<p>For more details on the framework please refer to the the <a class="reference external" href="https://github.com/OpenAMP/open-amp/wiki">OpenAMP wiki</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, OpenAMP Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>